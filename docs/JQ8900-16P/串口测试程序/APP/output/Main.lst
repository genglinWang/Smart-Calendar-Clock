C51 COMPILER V9.59.0.0   MAIN                                                              05/15/2022 22:14:31 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Output\Main.obj
COMPILER INVOKED BY: D:\keilv5\C51\BIN\C51.EXE src\User\Main.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE INCDIR(.\src\Delay;
                    -.\src\Key;.\src\Msg;.\src\Uart;.\src\Ui;.\src\User;.\src\Ui\ui_common;.\src\Ui\Lcd_seg;.\src\Ui\Led_seg;.\src\Ui\resourc
                    -;.\src\SPI;.\src\SD) DEBUG OBJECTEXTEND PRINT(.\Output\Main.lst) TABS(2) OBJECT(.\Output\Main.obj)

line level    source

   1          #include "main.h"
   2          
   3          bit bSysHalfSec;
   4          u8 TimeWaitCnt = 0;
   5          
   6          u8 code PrevFile[] = {0xAA, 0x05, 0x00, 0xAF};/*此数组指令可以直接由上位机生成，复制过来即可  */
   7          u8 code NextFile[] = {0xAA, 0x06, 0x00, 0xB0};
   8          u8 code Path[] = {0xAA, 0x08, 0x10, 0x02, 0x2F, 0xB9, 0xE3, 0xB8, 0xE6, 0x2A, 0x2F, 0xD0, 0xA1, 0xC3, 0xD7
             -, 0x2A, 0x4D, 0x50, 0x33, 0x8B, }; // flash   /广告*/小米*MP3
   9          
  10          
  11          
  12          /***************************************************************************************
  13          
  14          本程序为MP3串口模块测试程序C51版本，测试芯片采用 STC12C5A32S2,外部晶振，11.0592MHZ
  15          串口设置:9600
  16          
  17          
  18          
  19          **************************************************************************************/
  20          
  21          u8 UartData = 0xff;
  22          /*****************************************************************************
  23           函 数 名  : Timer0Init
  24           功能描述  : 定时器初使化 定时2毫秒@11.0592MHz
  25           输入参数  : void
  26           输出参数  : 无
  27           返 回 值  :
  28           调用函数  :
  29           被调函数  :
  30          
  31           修改历史      :
  32            1.日    期   : 2013年3月26日
  33              作    者   : Blueice
  34              修改内容   : 新生成函数
  35          
  36          *****************************************************************************/
  37          void Timer0Init ( void )
  38          {
  39   1          AUXR |= 0x80;   /*定时器时钟1T模式  */
  40   1          TMOD &= 0xF0;   /*设置定时器模式  */
  41   1          TMOD |= 0x01;   /*设置定时器模式  */
  42   1          TL0 = 0x9A;       /*设置定时初值  */
  43   1          TH0 = 0xA9;       /*设置定时初值  */
  44   1          TF0 = 0;        /*清除TF0标志  */
  45   1          TR0 = 1;        /*定时器0开始计时  */
  46   1          ET0 = 1;
  47   1      }
  48          /*****************************************************************************
  49           函 数 名  : SysInit
  50           功能描述  : 系统初使化
  51           输入参数  : void
  52           输出参数  : 无
C51 COMPILER V9.59.0.0   MAIN                                                              05/15/2022 22:14:31 PAGE 2   

  53           返 回 值  :
  54           调用函数  :
  55           被调函数  :
  56          
  57           修改历史      :
  58            1.日    期   : 2013年3月24日
  59              作    者   : Blueice
  60              修改内容   : 新生成函数
  61          
  62          *****************************************************************************/
  63          void SysInit ( void )
  64          {
  65   1          Timer0Init();
  66   1          UartInit();
  67   1          EA = 1;/*开总中断  */
  68   1      }
  69          /*****************************************************************************
  70           函 数 名  : Delay1us
  71           功能描述  : 1微秒延时函数
  72           输入参数  : int T
  73           输出参数  : 无
  74           返 回 值  :
  75           调用函数  :
  76           被调函数  :
  77          
  78           修改历史      :
  79            1.日    期   : 2016年2月19日
  80              作    者   : wskblueice
  81              修改内容   : 新生成函数
  82          
  83          *****************************************************************************/
  84          void Delay1us ( int T )
  85          {
  86   1          T = T - 70;
  87   1          do
  88   1          {
  89   2              ;
  90   2          }
  91   1          while ( T-- );
  92   1      }
  93          #define  sda   P01 /*一线串口发送引脚  */
  94          /*****************************************************************************
  95           函 数 名  : SendData
  96           功能描述  : 一线串口发送函数
  97           输入参数  : u16 N
  98           输出参数  : 无
  99           返 回 值  :
 100           调用函数  :
 101           被调函数  :
 102          
 103           修改历史      :
 104            1.日    期   : 2014年8月17日
 105              作    者   : wskblueice
 106              修改内容   : 新生成函数
 107          
 108          *****************************************************************************/
 109          void SendData ( u8 addr )
 110          {
 111   1          u8 i;
 112   1      
 113   1          EA = 0;/*发送时关掉中断，防止中断影响时序  */
 114   1      
C51 COMPILER V9.59.0.0   MAIN                                                              05/15/2022 22:14:31 PAGE 3   

 115   1          sda = 1;/*开始拉搞  */
 116   1          Delay1us ( 1000 );
 117   1          sda = 0;/*开始引导码*/
 118   1          Delay1us ( 2200 );/*此处延时最少要大于2ms，此参数延时为310ms  */
 119   1      
 120   1          for ( i = 0; i < 8; i++ ) /*总共8位数据  */
 121   1          {
 122   2              sda = 1;
 123   2              if ( addr & 0x01 ) /*3:1表示数据位1,每个位用两个脉冲表示  */
 124   2              {
 125   3                  Delay1us ( 500 );
 126   3                  sda = 0;
 127   3                  Delay1us ( 210 );
 128   3              }
 129   2              else              /*1：3表示数据位0 ,每个位用两个脉冲表示  */
 130   2              {
 131   3                  Delay1us ( 210 );
 132   3                  sda = 0;
 133   3                  Delay1us ( 500 );
 134   3              }
 135   2              addr >>= 1;
 136   2          }
 137   1          sda = 1;
 138   1          EA = 1;
 139   1      }
 140          /*****************************************************************************
 141           函 数 名  : UartSendData
 142           功能描述  : 两线串口发送指令
 143           输入参数  : u8 *Buff
 144           输出参数  : 无
 145           返 回 值  :
 146           调用函数  :
 147           被调函数  :
 148          
 149           修改历史      :
 150            1.日    期   : 2016年5月1日
 151              作    者   : wskblueice
 152              修改内容   : 新生成函数
 153          
 154          *****************************************************************************/
 155          void UartSendData ( u8 *Buff, u8 Len )
 156          {
 157   1          u8 i;
 158   1          for ( i = 0 ; i < Len ; i++ )
 159   1          {
 160   2              UartPutByte ( Buff[i] );
 161   2          }
 162   1      }
 163          /*****************************************************************************
 164           函 数 名  : main
 165           功能描述  : 系统主循环
 166           输入参数  : void
 167           输出参数  : 无
 168           返 回 值  :
 169           调用函数  :
 170           被调函数  :
 171          
 172           修改历史      :
 173            1.日    期   : 2013年2月21日
 174              作    者   : Blueice
 175              修改内容   : 新生成函数
 176          
C51 COMPILER V9.59.0.0   MAIN                                                              05/15/2022 22:14:31 PAGE 4   

 177          *****************************************************************************/
 178          void main ( void )
 179          {
 180   1      
 181   1          SysInit();
 182   1      
 183   1      
 184   1      
 185   1          P0M0 |= BIT ( 0 ) | BIT ( 1 );
 186   1          UartSendData ( Path, 20 );
 187   1          while ( 1 )
 188   1          {
 189   2              if ( TimeWaitCnt == 4 ) /*每隔两秒会自动发下一曲指令  */
 190   2              {
 191   3                  TimeWaitCnt = 0;
 192   3                  SendData ( 0x15 );//next file
 193   3                  //UartSendData ( NextFile,4 );
 194   3              }
 195   2          }
 196   1      }
 197          /*****************************************************************************
 198           函 数 名  : tm0_isr
 199           功能描述  : 定时中断
 200           输入参数  : 无
 201           输出参数  : 无
 202           返 回 值  :
 203           调用函数  :
 204           被调函数  :
 205          
 206           修改历史      :
 207            1.日    期   : 2013年3月26日
 208              作    者   : Blueice
 209              修改内容   : 新生成函数
 210          
 211          *****************************************************************************/
 212          void Timer0_isr() interrupt 1
 213          {
 214   1          static u8 TimeCnt;
 215   1      
 216   1          TL0 = 0x9A;   /*设置定时初值  */
 217   1          TH0 = 0xA9;   /*设置定时初值  */
 218   1      
 219   1          TimeCnt++;
 220   1          if ( ( TimeCnt % 5 ) == 0 )
 221   1          {
 222   2      
 223   2      
 224   2          }
 225   1          if ( ( TimeCnt % 250 ) == 0 )
 226   1          {
 227   2              TimeCnt = 0;
 228   2              bSysHalfSec = !bSysHalfSec;
 229   2              P00 = !P00;
 230   2              TimeWaitCnt++;
 231   2          }
 232   1      
 233   1      }
 234          
 235          


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.59.0.0   MAIN                                                              05/15/2022 22:14:31 PAGE 5   

   CODE SIZE        =    246    ----
   CONSTANT SIZE    =     28    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
